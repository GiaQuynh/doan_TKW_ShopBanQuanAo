!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";function e(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var n=function(e,n){var t,i,o,r,a=window.verne.mdm,s=a.application,c=a.platform,u=a.languageISO,l=a.countryISO,v=a.logged,d=a.externalID,m=a.country,p=a.environment,f=a.pageType,h=a.brand,y=a.isVOTF,w=a.isApp,g=a.emailSha256,b=(null===(t=window.dataLayerV2Json)||void 0===t||null===(i=t.user)||void 0===i?void 0:i.appsClientId)||(2===(o="; ".concat(document.cookie).split("_ga=")).length?o.pop().split(";").shift().slice(6):null);return window.verne.mdm.gaClientId=b,{application:s,platform:c,environment:p,emailSha256:g,ads_consent:e,analytics_consent:n,language_iso:u,user_logged:v,external_id:d,country_iso:(null==m?void 0:m.countryState)||l,page_type:f,page_brand:h,is_votf:y,is_app:w,search_term:(r="kw",new URLSearchParams(window.location.search).get(r)),ga_client_id:b}};function t(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}var i=function(){var e,n;return null===(e=window.verne)||void 0===e||null===(n=e.mdm)||void 0===n?void 0:n.isApp},o=function(){var e;return i()||-1!==(null===(e=window.OnetrustActiveGroups)||void 0===e?void 0:e.indexOf("C0004"))},r=function(){var e;return i()||-1!==(null===(e=window.OnetrustActiveGroups)||void 0===e?void 0:e.indexOf("C0002"))},a=function(a){var s=r()||function(){var e,n;return null===(e=window.verne)||void 0===e||null===(n=e.mdm)||void 0===n?void 0:n.logged}();s||window.gtag("set","ads_data_redaction",!0),window.gtag("consent","default",{analytics_storage:s?"granted":"denied"});var c=function(n){for(var i=1;i<arguments.length;i++){var o=null!=arguments[i]?arguments[i]:{};i%2?t(Object(o),!0).forEach((function(t){e(n,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))}))}return n}({event:"loadDataLayer"},n(o(),r()));a&&(c.page_location=a,c.vpvName=a),i()&&(c.event_name="screen_view",c.screen_view={screen_name:a||window.location.href,screen_class:window.verne.mdm.pageType||"unknown"},window.verne.apps.analytics(c)),window.dataLayer.push(c),window.verne.analytics.cleanFifos()},s=function(e){window.dataLayer.push({user:{adsConsent:o(),analyticsConsent:r()}}),a(e),window.gtag("consent","default",{ad_storage:o()?"granted":"denied"}),o()&&window.dataLayer.push({event:"loadAds"})};window.gtag=function(){window.dataLayer.push(arguments)};var c={ads:o,analytic:r,startGTM:function(e){if(window.verne.masterDataLoaded)s(e);else{var n=setTimeout((function(){s(e)}),3e3);window.addEventListener("window.verne.masterData.loaded",(function t(){s(e),window.removeEventListener("window.verne.masterData.loaded",t),clearTimeout(n)}))}}};function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function l(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function v(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(e,n,t){return n&&v(e.prototype,n),t&&v(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}var m=function(){function n(){var e;l(this,n),this.eventLoadDataLayerName="loadDataLayer",this.fifo=new Set,this.cleanedFifos=[],this.bannedValues=[this.eventLoadDataLayerName,"gtm.js","gtm.dom","gtm.load","OptanonLoaded","OneTrustLoaded","OneTrustGroupsUpdated"],(e=window).dataLayer||(e.dataLayer=[])}return d(n,[{key:"isLoaded",value:function(){var e=this;return window.dataLayer.some((function(n){return n.event===e.eventLoadDataLayerName}))}},{key:"isFifoEvent",value:function(e){var n=this,t=!0;return e.event?Object.entries(e).forEach((function(e){n.bannedValues.includes(e[1])&&(t=!1)})):t=!1,"object"===u(e)&&e.length&&(t=!1),t}},{key:"cleanFifos",value:function(){if(this.fifo.size>0){this.isCleaningFifos=!0;var e=this;this.fifo.forEach((function(t){var i=t();Object.keys(i).length&&(e.fifo.delete(t),e.cleanedFifos.push(i),n.sendEvent(i))}))}}},{key:"push",value:function(e){var t=e();t&&(this.isLoaded()?(n.sendEvent(t),this.isCleaningFifos||this.cleanFifos()):this.isFifoEvent(t)?this.fifo.add(e):n.sendEvent(t))}},{key:"generic",value:function(n,t){if(!n)throw new Error("[MNG Verne] Event name is mandatory");var i={event:"GA4-generic-".concat(n),event_name:n};t&&(i[n]=t,this.push((function(){return e({},n,null)}))),this.push((function(){return i}))}}],[{key:"sendEvent",value:function(e){window.verne.mdm.isApp&&e.event_name?window.verne.apps.analytics(e):window.dataLayer.push(e)}}]),n}();function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function f(n){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?p(Object(i),!0).forEach((function(t){e(n,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))}))}return n}var h=function(e){return JSON.parse(JSON.stringify(f(f({},e),{},{variant:e.colorId||e.variant,dimension17:e.dimension17||e.gender,dimension21:e.dimension21||e.colorId,dimension22:e.dimension22||e.sizeId,dimension27:e.dimension27||e.label,dimension56:e.dimension56||e.sizeAvailability,dimension57:e.dimension57||e.sizeNoAvailability,dimension61:e.dimension61||e.exclusiveOnline,dimension92:e.dimension92||e.look||"00",dimension107:e.dimension107||e.colorName,dimension108:e.dimension108||e.personalized,dimension117:e.dimension117||e.subBrand||e.brand,dimension122:e.dimension122||e.recommendedSize,dimension123:e.dimension123||e.sizingType,dimension124:e.dimension124||e.sizeName,dimension131:e.dimension131||e.priceType})))},y=function(){var e,n;return(null===(e=window.verne)||void 0===e||null===(n=e.mdm)||void 0===n?void 0:n.pageType)||"other"},w=function(e){var n={ecommerce:{add:{products:[f({},h(e))]}},eventCategory:y(),locationDetalle:"".concat(y(),"-").concat(e.location||"unknown"),eventAction:"anadir a bolsa",eventLabel:"add",event:"EECEvent"};window.verne.analytics.push((function(){return n}))},g=function(e){var n={eventCategory:y(),eventAction:"beginCheckout",eventLabel:e,event:"analyticsEvent"};window.verne.analytics.push((function(){return n}))},b=function(e){var n={event:"removeFromCart",eventCategory:y(),eventAction:"eliminar-producto",eventLabel:e.location,ecommerce:{remove:{products:[f({},h(e))]}}};window.verne.analytics.push((function(){return n}))},_=function(e){var n=e.list,t={ecommerce:{click:{products:[f({},h(e))],actionField:{list:n}}},eventCategory:y(),eventAction:"productClick",eventLabel:n,event:"EECEvent"};window.verne.analytics.push((function(){return t}))},E=function(e){var n=e.name,t={ecommerce:{promoClick:{promotions:[e]}},eventCategory:y(),eventAction:"promoClick",eventLabel:n,event:"EECEvent"};window.verne.analytics.push((function(){return t}))},O=function(e,n){var t={ecommerce:{impressions:e.map((function(e){return f(f({},e),{},{position:e.index,dimension117:e.subBrand||e.brand})}))},eventCategory:y(),eventAction:"impressions",eventLabel:n,event:"EECEvent"};window.verne.analytics.push((function(){return t}))},C=function(e){var n=h(e),t="".concat(n.id,"-").concat(n.variant),i={event:"addToFavorites",eventCategory:y(),eventAction:"anadir a favoritos",eventLabel:t,ecommerce:{addToFavorites:{actionField:{list:e.list},products:[n]}}};window.verne.analytics.push((function(){return i}))},k=function(e){var n=h(e),t="".concat(n.id,"-").concat(n.variant),i={event:"removeFromFavorites",eventCategory:y(),eventAction:"eliminar de favoritos",eventLabel:t,ecommerce:{addToFavorites:{actionField:{list:e.list},products:[n]}}};window.verne.analytics.push((function(){return i}))},L=function(e,n){var t={event:e,ecommerce:null};t.ecommerce={promoView:{promotions:n}},window.verne.analytics.push((function(){return t}))},I=function(e){var n;return(null===(n=window.google_tag_manager)||void 0===n?void 0:n.debugGroupId)?"developer":e?"external":"internal"},j=function(e,n){var t,i=window.verne.consent.ads(),o=window.verne.consent.analytic();if(o||i){var r=window.verne.mdm,a=r.gaClientId,s=r.externalID,c=r.languageISO,u=r.platform,l=r.environment,v=r.application,d=r.emailSha256,m=r.brand,p=r.country.countryState,f=r.pageType,h="pro"===l,y=JSON.stringify({client_id:a,user_id:s,non_personalized_ads:!1,events:[{name:e,params:{ads_consent:i,analytics_consent:o,application:v,country_iso:p,email:d,environment:l,gtm_environment:h?"live":"staging",items:[(t=n,JSON.parse(JSON.stringify({item_id:t.id,item_category2:t.sizeId,item_category3:t.dimension92||t.look||"00",item_category4:"no-personalized"!==(t.dimension108||t.personalized),item_list_id:t.list,item_list_name:t.list,item_variant:t.colorId||t.variant,index:t.index||t.position||1,quantity:t.quantity||1})))],item_list_id:n.list,item_list_name:n.list,language_iso:c,page_brand:m,page_location:window.location.href,page_type:f,platform:u,traffic_type:I(h)}}]});return navigator.sendBeacon("/ws-wa-sqs-collector/ga-events",new Blob([y]))}return null};function P(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function D(n){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?P(Object(i),!0).forEach((function(t){e(n,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):P(Object(i)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))}))}return n}var A,T,S="visibilitychange",V="beforeunload",F="EUR",G="unknown",x=function(){function n(){var e,t,i,o,r=this;l(this,n),this.beaconEvent=j,this.push=function(e){return window.verne.analytics.push((function(){return e}))},this.pageType=function(){var e,n;return(null===(e=window.verne)||void 0===e||null===(n=e.mdm)||void 0===n?void 0:n.pageType)||"other"},this.visibilityChangeListenerIsActive=!1,this.beforeUnloadListenerIsActive=!1,this.impressions=[],this.promoViews=[],this.stackImpressionsCount=0,this.impressionsTotalCount=0,this.impressionPosition=1,this.maxStackImpressionsCount=60,this.beforeUnloadRef=function(e){return r.sendEventsBeforeUnload(e)},this.visibilityChangeRef=function(e){return r.sendEventsBeforeUnload(e)},this.isMobileOrTablet="mobile"===(null===(e=window.verne)||void 0===e||null===(t=e.mdm)||void 0===t?void 0:t.platform)||"tablet"===(null===(i=window.verne)||void 0===i||null===(o=i.mdm)||void 0===o?void 0:o.platform),this.init()}return d(n,[{key:"init",value:function(){this.beforeUnloadListenerIsActive||(window.addEventListener(V,this.beforeUnloadRef),this.beforeUnloadListenerIsActive=!0),!this.visibilityChangeListenerIsActive&&this.isMobileOrTablet&&(window.addEventListener(S,this.visibilityChangeRef),this.visibilityChangeListenerIsActive=!0)}},{key:"clearDataLayerEvent",value:function(n){this.push(e({},n,null))}},{key:"viewCart",value:function(e){var t=e.products,i=e.location,o="view_cart";this.clearDataLayerEvent(o);var r=t.map((function(e){return n.getEECItem(e)})),a={event:"GA4-EEC-viewCart",event_name:o,view_cart:{currency:F,value:n.getTotalValue(r),location:i||G,items:r}};this.push(a)}},{key:"addToCart",value:function(e,t){var i="add_to_cart";this.clearDataLayerEvent(i);var o=n.getEECItem(e),r={event:"GA4-EEC-addToCart",event_name:i,add_to_cart:{currency:F,value:n.getTotalValue([o]),location:e.location||G,items:[o],mng_items:t}};this.push(r),w(e)}},{key:"removeFromCart",value:function(e,t){var i="remove_from_cart";this.clearDataLayerEvent(i);var o=n.getEECItem(e),r={event:"GA4-EEC-removeFromCart",event_name:i,remove_from_cart:{currency:F,value:n.getTotalValue([o]),location:e.location||G,items:[o],mng_items:t}};this.push(r),b(e)}},{key:"productClick",value:function(e){var t="select_item";this.clearDataLayerEvent(t);var i=n.getEECItem(e),o={event:"GA4-EEC-selectItem",event_name:t,select_item:{currency:F,value:n.getTotalValue([i]),items:[i]}};this.push(o),_(e)}},{key:"productDetailView",value:function(e){var t="view_item";this.clearDataLayerEvent(t);var i=n.getEECItem(e),o={event:"GA4-EEC-itemDetailView",event_name:t,view_item:{currency:F,value:n.getTotalValue([i]),items:[i]}};this.push(o)}},{key:"beginCheckout",value:function(e){var t=e.products,i=e.location,o="begin_checkout";this.clearDataLayerEvent(o);var r=t.map((function(e){return n.getEECItem(e)})),a={event:"GA4-EEC-beginCheckout",event_name:o,begin_checkout:{currency:F,value:n.getTotalValue(r),location:i,items:r}};this.push(a),g(i)}},{key:"addShippingInfo",value:function(e,t){var i="add_shipping_info";this.clearDataLayerEvent(i);var o=e.map((function(e){return n.getEECItem(e)})),r={event:"GA4-EEC-addShippingInfo",event_name:i,add_shipping_info:{currency:F,value:n.getTotalValue(o),shipping_tier:t,items:o}};this.push(r)}},{key:"addPaymentInfo",value:function(e,t){var i="add_payment_info";this.clearDataLayerEvent(i);var o=e.map((function(e){return n.getEECItem(e)})),r={event:"GA4-EEC-addPaymentInfo",event_name:i,add_payment_info:{currency:F,value:n.getTotalValue(o),payment_type:t,items:o}};this.push(r)}},{key:"purchase",value:function(e,t){var i="purchase";this.clearDataLayerEvent(i);var o=e.map((function(e){return n.getEECItem(e)})),r={event:"GA4-EEC-purchase",event_name:i,purchase:D(D({},t),{},{currency:F,value:n.getTotalValue(o),items:o})};this.push(r)}},{key:"loginCheckout",value:function(e){var t="login_checkout";this.clearDataLayerEvent(t);var i=e.map((function(e){return n.getEECItem(e)})),o={event:"GA4-EEC-loginCheckout",event_name:t,login_checkout:{currency:F,value:n.getTotalValue(i),items:i}};this.push(o)}},{key:"registerCheckout",value:function(e){var t="register_checkout";this.clearDataLayerEvent(t);var i=e.map((function(e){return n.getEECItem(e)})),o={event:"GA4-EEC-registerCheckout",event_name:t,register_checkout:{currency:F,value:n.getTotalValue(i),items:i}};this.push(o)}},{key:"addToWishlist",value:function(e){this.beaconEvent("add_to_wishlist",e),C(e)}},{key:"removeFromWishlist",value:function(e){this.beaconEvent("remove_from_wishlist",e),k(e)}},{key:"search",value:function(e){var n="search";this.clearDataLayerEvent(n);var t={event:"GA4-search",event_name:n,search_term:e,search:{search_term:e}};this.push(t)}},{key:"login",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"native",n="login";this.clearDataLayerEvent(n);var t={event:"GA4-login",event_name:n,login:{method:e}};this.push(t)}},{key:"signUp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"native",n="sign_up";this.clearDataLayerEvent(n);var t={event:"GA4-signUp",event_name:n,sign_up:{method:e}};this.push(t)}},{key:"promoView",value:function(e){this.promoViews.push(e)}},{key:"impression",value:function(e){this.impressions.push(D(D({},e),{},{index:this.impressionPosition})),this.stackImpressionsCount+=1,this.impressionsTotalCount+=1,this.impressionPosition+=1,this.stackImpressionsCount>=this.maxStackImpressionsCount&&this.impressions.length>0&&(this.sendImpressions(),this.stackImpressionsCount=0)}},{key:"sendImpressions",value:function(){var e="view_item_list";this.clearDataLayerEvent(e);var t={event:"GA4-EEC-viewItemList",event_name:e,view_item_list:{items:this.impressions.map((function(e){return D({},n.getEECItem(e))}))}};window.verne.analytics.push((function(){return t})),O(this.impressions,this.impressionsTotalCount),this.impressions=[]}},{key:"promoClick",value:function(e){var t="select_promotion";this.clearDataLayerEvent(t);var i={event:"GA4-EEC-selectPromotion",event_name:t,select_promotion:{items:[n.getEECPromotion(e)]}};this.push(i),E(e)}},{key:"sendPromoViews",value:function(e){var t="view_promotion";this.clearDataLayerEvent(t);var i={event:"GA4-EEC-viewPromotion",event_name:t,view_promotion:{items:this.promoViews.map((function(e){return D({},n.getEECPromotion(e))}))}};window.verne.analytics.push((function(){return i})),L(e,this.promoViews),this.promoViews=[]}},{key:"sendEventsBeforeUnload",value:function(e){var n,t=(null==e?void 0:e.type)===V,i=this.isMobileOrTablet&&"hidden"===document.visibilityState;if(this.impressions.length>0&&this.sendImpressions(),(null===(n=this.promoViews)||void 0===n?void 0:n.length)>0){var o=(null==e?void 0:e.type)===S?S:V;this.sendPromoViews(o)}t&&(window.removeEventListener(V,this.beforeUnloadRef),this.beforeUnloadListenerIsActive=!1),i?(window.removeEventListener(S,this.visibilityChangeRef),this.visibilityChangeListenerIsActive=!1):(this.impressionPosition=1,this.impressionsTotalCount=0),this.stackImpressionsCount=0}}],[{key:"getEECItem",value:function(e){return JSON.parse(JSON.stringify({item_name:e.name,item_id:e.id,item_brand:e.brand,item_category:e.category,item_category2:e.sizeId,item_category3:e.dimension92||e.look||"00",item_category4:e.dimension108||e.personalized,item_category5:e.dimension117||e.subBrand||e.brand,item_list_id:e.list,item_list_name:e.list,item_variant:e.colorId||e.variant,index:e.index||e.position||1,price:e.price,discount:e.discount||0,quantity:e.quantity||1,value:parseFloat((e.price-(e.discount||0)).toFixed(2))}))}},{key:"getEECPromotion",value:function(e){return JSON.parse(JSON.stringify({promotion_id:null==e?void 0:e.id,promotion_name:null==e?void 0:e.name,creative_name:null==e?void 0:e.creative,creative_slot:null==e?void 0:e.position}))}},{key:"getTotalValue",value:function(e){return parseFloat(e.reduce((function(e,n){return e+n.value*n.quantity}),0).toFixed(2))}}]),n}();function N(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function U(n){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?N(Object(i),!0).forEach((function(t){e(n,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):N(Object(i)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))}))}return n}var z=(null===(A=window.verne)||void 0===A?void 0:A.analytics)||new m,J=(null===(T=window.verne)||void 0===T?void 0:T.eec)||new x;window.verne=U(U({},window.verne),{},{analytics:z,consent:c,eec:J})}));
